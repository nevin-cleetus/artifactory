# JFrog Artifactory

	 
# Installation

JDK 1.8
sudo yum install java-1.8.0-openjdk-devel


# Installing Artifactory

wget https://bintray.com/jfrog/artifactory-rpms/rpm -O bintray-jfrog-artifactory-rpms.repo

sudo mv bintray-jfrog-artifactory-rpms.repo /etc/yum.repos.d/

sudo yum install jfrog-artifactory-oss


# Update the Java options and the artifactory related path

sudo su –

cd /opt/jfrog/artifactory/bin  

vi artifactory.default and update the Xms value to 1g

export JAVA_OPTIONS="-server -Xms512m -Xmx1g…. 

#export ARTIFACTORY_HOME=/var/opt/jfrog/artifactory

#export ARTIFACTORY_USER=artifactory

#export JAVA_HOME=/opt/java/1.8.0

Running Artifactory

To start or stop Artifactory you must be running as root and can use the following command:

cd /opt/jfrog/artifactory/bin$service artifactory start | stop

# Setup Service

sudo service artifactory start
	
Test the artifactory URL using the below link.

http://<ip address>:8081/artifactory (admin/password)


	
# Database Configuration

JFrog supports MySQL, Oracle, MSSQL Server and PostgreSQL along with build in Derby DB which could be used for development purpose. For Production installations, it is recommended to use one of the other database.


Once DB is identified, an artifactory user need to be created and configured to use by artifactory. The DB configuration is present in 

	/var/opt/jfrog/artifactory/etc/db.properties

In order to use any DB other than Derby, copy the respective DB configuration property file from the /var/opt/jfrog/artifactory/misc/db/ directory and replace the content of db.properties.


For Exp:-  In order to use mysql, copy the content from /var/opt/jfrog/artifactory/misc/db/mysql.proeprties, modify the connection entries and replace in db.properties file. We also need to create an artifactory user with required permission in order for JFrog to use.  The scripts to create the user and grant the permissions is available under the folder

	/var/opt/jfrog/artifactory/misc/db/created/

In case of external DB configuration, the jdbc driver files need to be copied and made available under Tomcat lib directory. 


File Storage Configuration

Artifactory support different storage providers along with the option to chain a series of providers together to build complex structures. Storage provider details can be configured in “binarystore.xml” present under /var/opt/jfrog/artifactory/etc/.  Refer below link for configurations supported by storage providers.

	https://www.jfrog.com/confluence/display/RTF5X/Configuring+the+Filestore


Configuring a Reverse Proxy

You can configure access to Artifactory via HTTP, HTTPS or both using a reverse proxy such as NGINX or Apache.  Artifactory provide an option to automatically generate the Reverse Proxy configuration from the UI. 
 
Admin -> Http Settings -> Reverse Proxy Settings and configure the artifactory IP address and the port number which need to be redirected to the reverse proxy settings. 




		
	
Using Nginx as Reverse Proxy

	sudo yum install epel-release
	sudo yum install nginx

	Configure the /etc/nginx/nginx.conf  to include the content generated by Artifactory	

sudo systemctl enable nginx

sudo systemctl start nginx


	
Maven Installation

	/opt>sudo su –
        
	/opt>wget http://apachemirror.wuchna.com/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz

        /opt>tar -xvf apache-maven-3.6.3-bin.tar.gz
	
	/opt>export M2_HOME=/opt/apache-maven-3.6.3
        
	/opt>export PATH=$PATH:$M2_HOME/bin
        
	/opt>mvn -version           
	

	/opt>mkdir gitrepo
	
/opt>cd gitrepo

/opt/gitrepo>git clone https://github.com/nevin-cleetus/hello.git

/gitrepo>mvn clean install 

		
Deploy artifacts to a repository

	Generate Maven Settings
	Click on "Generate Maven Settings" in order to resolve artifacts through Virtual or Remote repositories.
	This will ensure the dependent jar files/artifacts are downloaded from the repository. 
			
Deploy 
To deploy build artifacts through Artifactory you need to add a deployment element with the URL of a target local repository to which you want to deploy your artifacts. 

For example:
	<distributionManagement>
       		<repository>
         		<id>central</id>
         		<name>jfrog-releases</name>
         		<url>http://192.168.120.11:8081/artifactory/hello-maven-release-virtual</url>
       		</repository>
       		<snapshotRepository>
        		<id>snapshots</id>
        		<name>jfrog-snapshots</name>
        		<url>http://192.168.120.11:8081/artifactory/hello-maven-snapshot-local</url>
       		</snapshotRepository>
    	</distributionManagement>

	



Jenkins Maven Integration
 

Install artifactory plugin

Jenkins -> Manage Jenkins -> Plugin Manager 

Search “artifactory” and install the plugin. Choose Install without restart


Configure Artifactory Credentials in Jenkins

Global Credentials -> Add Credentials -> User name and Password


Add JDK in Jenkins

Global tools configuration

	JDK -> JDK Installation -> Mention ID and the JDK path

Add Maven 

	Maven ->  Add an identifier and the Maven path


Jenkins Artifactory Integration

Jenkins -> System Configuration ->

Use an ID and configure the Artifactory URL.  Use the artifactory credentials configured in the previous step.




Artifactory LDAP Integration

	LDAP ->    ldap://ldap.forumsys.com:389/dc=example,dc=com
	
	User DN Pattern		uid={0}
	Search Filter			(uid={0})	
	Manager  DN			cn=admin,dc=example,dc=com	
	Password			password
	
Username			riemann
	Password			password


